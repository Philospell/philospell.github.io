name: Fetch Notion Content and Commit

on:
  schedule:
    - cron: '0 13 * * *'  # 매일 밤 10시 (KST) 실행 (GitHub Actions는 UTC 기준이므로 13시로 설정)
  workflow_dispatch:  # 수동 실행 트리거

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest
    steps:
      - name: 저장소 체크아웃
        uses: actions/checkout@v3

      - name: Node.js 설정
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: 의존성 설치
        run: npm install

      - name: Notion 글 가져오기 및 MDX 파일 생성
        run: node src/scripts/notion_to_mdx.js
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}

      - name: 변경 사항 커밋 및 푸시
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add .
          # 한국 표준시(KST)로 현재 날짜 및 시간 설정
          export TZ='Asia/Seoul'
          current_date=$(date +"%Y-%m-%d %H:%M:%S %Z")
          git commit -m "Add new blog post from Notion at ${current_date}"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
